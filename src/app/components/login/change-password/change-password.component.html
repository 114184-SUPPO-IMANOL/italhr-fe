<div *ngIf="loading" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background-color: rgba(0, 0, 0, 0.5);">
    <div class="spinner-border" role="status" style="width: 3rem; height: 3rem;">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>  
<br><br><br><br>
<div class="container" *ngIf="pageValidateEmail && !loading">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Restablecer Contraseña </div>
                <div class="card-body">
                    <p>
                        Para restablecer su contraseña, por favor ingrese la dirección de correo electrónico asociada a su cuenta.
                        Enviaremos un token asociado a dicha dirección de correo electrónico para que pueda cambiar la contraseña.
                    </p>
                </div>
                <div class="card-body">
                    <form [formGroup]="formValidateEmail">
                        <div class="form-group">
                            <label for="email">Correo Electrónico</label>
                            <input type="email" id="email" class="form-control" formControlName="email"
                            [ngClass]="{ 'is-invalid': formValidateEmail.get('email')?.invalid && formValidateEmail.get('email')?.touched }">
                            <small
                            class="invalid-feedback"
                            *ngIf="
                              !formValidateEmail.get('email')!.valid &&
                              formValidateEmail.get('email')!.touched &&
                              formValidateEmail.get('email')!.getError('required')
                            "
                          >
                            El correo electrónico es requerido
                          </small>
                            <small
                                class="invalid-feedback"
                                *ngIf="
                                !formValidateEmail.get('email')!.valid &&
                                formValidateEmail.get('email')!.touched &&
                                formValidateEmail.get('email')!.getError('email')
                                " >
                                El correo electrónico no es válido
                            </small>
                        </div>
                        <br>
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="button" class="btn btn-secondary"(click)="onCancelar()">Cancelar</button>
                            <button type="submit" class="btn btn-primary" (click)="onSubmitValidateEmail()">Enviar</button>
                          </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="container" *ngIf="pageAccessToken">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Restablecer Contraseña </div>
                <div class="card-body">
                    <p>
                        Para restablecer su contraseña, por favor ingrese el token que se envió en su dirección de correo electrónico.
                    </p>
                </div>
                <div class="card-body">
                    <form [formGroup]="formValidateToken">
                        <div class="form-group">
                            <div class="row">
                                <label for="contador">Contador</label>
                                <div id="contador" class="contador">{{counter}}</div>
                            </div>
                            <div class="row">
                                <label for="token">Token</label>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col-2">
                                    <input type="number" id="token1" class="form-control" formControlName="token1" oninput="this.value = this.value.slice(0, 1)" style="text-align: center;" (input)="changeInput('token2')">
                                </div>
                                <div class="col-2">
                                    <input type="number" id="token2" class="form-control" formControlName="token2" oninput="this.value = this.value.slice(0, 1)" style="text-align: center;" (input)="changeInput('token3')">
                                </div>
                                <div class="col-2">
                                    <input type="number" id="token3" class="form-control" formControlName="token3" oninput="this.value = this.value.slice(0, 1)" style="text-align: center;" (input)="changeInput('token4')">
                                </div>
                                <div class="col-2">
                                    <input type="number" id="token4" class="form-control" formControlName="token4" oninput="this.value = this.value.slice(0, 1)" style="text-align: center;" (input)="changeInput('token5')">
                                </div>
                                <div class="col-2">
                                    <input type="number" id="token5" class="form-control" formControlName="token5" oninput="this.value = this.value.slice(0, 1)" style="text-align: center;" (input)="changeInput('token6')">
                                </div>
                                <div class="col-2">
                                    <input type="number" id="token6" class="form-control" formControlName="token6" oninput="this.value = this.value.slice(0, 1)" style="text-align: center;">
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="form-check text-start my-3">
                            <a class="form-check-label" (click)="resetToken()" style="cursor: pointer;">
                                Volver a enviar token
                            </a>
                        </div>
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="button" class="btn btn-secondary"(click)="onCancelar()">Cancelar</button>
                            <button type="submit" class="btn btn-primary" (click)="onSubmitValidateToken()">Enviar</button>
                          </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="container" *ngIf="pageChangePassword">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Restablecer Contraseña </div>
                <div class="card-body">
                    <p>
                        Ingrese su nueva contraseña.
                    </p>
                </div>
                <div class="card-body">
                    <form [formGroup]="formChangePassword">
                        <div class="form-group">
                            <label for="password">Contraseña</label>
                            <input type="password" id="password" class="form-control" formControlName="password"
                            [ngClass]="{ 'is-invalid': formChangePassword.get('password')?.invalid && formChangePassword.get('password')?.touched }">
                            <small class="invalid-feedback" *ngIf="formChangePassword.get('password')?.invalid && formChangePassword.get('password')?.touched &&
                            formChangePassword.get('password')?.getError('required')">
                            La contraseña es requerida</small>
                            <small class="invalid-feedback" *ngIf="formChangePassword.get('password')?.invalid && formChangePassword.get('password')?.touched &&
                            formChangePassword.get('password')?.getError('minlength')">
                            la contraseña no puede tener menos de 8 caracteres</small>
                            <small class="invalid-feedback" *ngIf="formChangePassword.get('password')?.invalid && formChangePassword.get('password')?.touched &&
                            formChangePassword.get('password')?.getError('maxlength')">
                            la contraseña no puede tener más de 255 caracteres</small>
                            <small class="invalid-feedback" *ngIf="formChangePassword.get('password')?.invalid && formChangePassword.get('password')?.touched &&
                            formChangePassword.get('password')?.getError('pattern')">
                            la contraseña debe tener al menos 1 mayúscula, 1 minuscula, 1 número y 1 simbolo</small>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="repeatPassword">Confirmar contraseña</label>
                            <input type="password" id="repeatPassword" class="form-control" formControlName="repeatPassword"
                            [ngClass]="{ 'is-invalid': formChangePassword.get('repeatPassword')?.invalid && formChangePassword.get('repeatPassword')?.touched }">
                            <small class="invalid-feedback" *ngIf=" !formChangePassword.get('repeatPassword')!.valid && formChangePassword.get('repeatPassword')!.touched &&
                            formChangePassword.get('repeatPassword')!.getError('required')">
                            La confirmación de contraseña es requerido</small>
                        </div>
                        <small class="form-text text-danger error-message" *ngIf="!formChangePassword.valid && formChangePassword.getError('match-password')">
                            La contraseñas no coinciden</small>
                        <br>
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="button" class="btn btn-secondary"(click)="onCancelar()">Cancelar</button>
                            <button type="submit" class="btn btn-primary" (click)="onSumbitChangePassword()">Enviar</button>
                          </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<br><br><br><br>